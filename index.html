<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Chess</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d2d2d">
    <!-- PeerJS Library for WebRTC simplified -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>

    <div class="main-content">
        <h1>Special Chess</h1>
        <div id="turnDisplay">White's Turn</div>
        <div id="materialCount" class="material-count"></div>

        <div class="board-container">
        <div class="coord-ranks"><span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span></div>
        <div id="board" class="board"></div>
        <div class="coord-files"><span>a</span><span>b</span><span>c</span><span>d</span><span>e</span><span>f</span><span>g</span><span>h</span></div>
        <!-- Promotion Modal -->
        <div id="promotionModal" class="modal hidden">
            <h3 style="color:white">Promote to:</h3>
            <div id="promoOptions" class="promo-opts"></div>
        </div>
    </div>

    <div id="status"></div>

    <div class="timer-container hidden" id="timerContainer">
        <div id="whiteTimer" class="timer"><div class="lbl">White</div><div class="timer-time">10:00</div></div>
        <div id="blackTimer" class="timer"><div class="lbl">Black</div><div class="timer-time">10:00</div></div>
    </div>

        </div>
    </div>

    <div class="side-panel">
        <!-- Main Controls -->
    <div class="controls">
        <div class="btn-row hidden" id="assassinControls">
            <button id="btnAssassin">ğŸ‘ï¸ Show Assassin</button>
        </div>
        <div class="btn-row">
            <button id="btnUndo">â†¶ Undo</button>
            <button id="btnRedo">â†· Redo</button>
            <button id="btnSave">ğŸ’¾ Save</button>
            <button id="btnLoad">ğŸ“ Load</button>
        </div>
        <div class="btn-row">
            <button id="networkBtn">ğŸŒ Network Play</button>
            <button id="gameOptionsBtn">ğŸ New Game</button>
        </div>
    </div>

    <!-- History -->
    <div id="moveHistory" class="hidden"></div>

    <!-- Network Game Controls -->
    <div class="network-controls hidden" id="networkControls">
        <div class="btn-row">
            <button id="btnCreateRoom" class="primary">Create Room</button>
            <button id="btnJoinGame">Join Game</button>
            <button id="btnDisconnect" class="secondary">Disconnect</button>
        </div>
        <div class="connection-status" id="connectionStatus">
            <div id="statusText">Not connected</div>
            <div id="roomCodeContainer" class="hidden">
                Your ID: <span id="roomCode" class="room-code">...</span>
                <button id="btnCopyCode" class="small-btn">ğŸ“‹ Copy</button>
            </div>
        </div>
    </div>

    <!-- Game Options -->
    <div class="game-options hidden" id="gameOptions">
        <div class="opt-row horizontal">
            <div class="opt-item">
                <label>
                    <span>â±ï¸</span>
                    <input type="checkbox" id="optTimer" checked>
                </label>
            </div>
            <div class="opt-item">
                <label>
                    <span>ğŸ¦•</span>
                    <input type="checkbox" id="optDino">
                </label>
            </div>
            <div class="opt-item">
                <label class="info-bubble">
                    <span>ğŸ¥·</span>
                    <span class="tooltip">
                        <strong>Assassin Rules:</strong><br>
                        â€¢ Place in front of pawn (rank 3/6)<br>
                        â€¢ Hidden until enemy pawn attacks or passes<br>
                        â€¢ Moves 2 squares, captures 1<br>
                        â€¢ Can be blind-captured
                    </span>
                    <input type="checkbox" id="optAssassin">
                </label>
            </div>
        </div>
        <div class="btn-row" style="margin-top:10px">
            <button id="btnNewGame" class="primary">ğŸ® Start New Game</button>
        </div>
    </div>

    <!-- Join Game Dialog -->
    <div id="joinDialog" class="modal hidden">
        <div class="dialog-content">
            <h3>Join Network Game</h3>
            <p>Paste the Room ID from your friend:</p>
            <input type="text" id="roomInput" placeholder="Paste Room ID here..." style="width: 250px; padding: 8px; margin: 10px 0; font-size: 14px;">
            <div class="btn-row">
                <button id="btnJoinRoomDialog" class="primary">Join</button>
                <button id="btnCancelJoin">Cancel</button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Service Worker with iOS 12 compatibility check
        if ('serviceWorker' in navigator) {
            // Check if we're on iOS 12 or older
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isOldIOS = isIOS && /OS 1[0-2]_/.test(navigator.userAgent);
            
            if (!isOldIOS) {
                navigator.serviceWorker.register('sw.js').catch(function(err) {
                    console.log('Service Worker registration failed:', err);
                });
            }
        }
    </script>
    <script src="js/main.js" type="module"></script>
</body>
</html>
